<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tap Battle — Juego de Pulsaciones</title>
<style>
  :root{
    --accent:#2563eb;
    --bg:#0b0d12;
    --panel:#121621;
    --muted:#a5b4fc;
    --ok:#22c55e;
    --warn:#f59e0b;
    --danger:#ef4444;
    --text:#e5e7eb;
    --text-dim:#cbd5e1;
    --bar-height:260px;
    --circle-size:40vmin;
  }

  *{ box-sizing:border-box; }
html,body{
  height:auto;
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
}
  button, input, select{ font:inherit; }

  /* 3 bloques verticales */
  .app{ display:flex; flex-direction:column; min-height:100dvh; max-width:1000px; margin:0 auto; }
  .top,.middle,.bottom{ width:100%; padding:12px; }
.top{ min-height:290px; overflow:visible; z-index:3; }
.middle{ min-height:280px; overflow:visible; z-index:2; }
.bottom{ min-height:240px; display:flex; align-items:center; justify-content:center; overflow:hidden; z-index:1; }

  .card{
    background:var(--panel); border:1px solid #1e2433; border-radius:16px;
    padding:12px; box-shadow:0 8px 24px rgba(0,0,0,.35);
  }
  .section-title{ margin:0 0 8px 0; font-weight:700; letter-spacing:.2px; color:#e9ecff; }

  .controls{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .field{ display:flex; flex-direction:column; gap:6px; }
  .field label{ font-size:.9rem; color:var(--text-dim); }
  .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .row > *{ flex:1; min-width:110px; }
  .muted{ color:var(--text-dim); font-size:.9rem; }
  .switch{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none; }
  .switch input{ accent-color:var(--ok); width:18px; height:18px; }

  .btn{
    border:none; background:var(--accent); color:white;
    padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700;
    box-shadow:0 6px 14px rgba(37,99,235,.35);
  }
  .btn.secondary{ background:#2a3248; color:#eaf; box-shadow:none; border:1px solid #334060; }
  .btn.warning{ background:var(--warn); color:#1b1302; box-shadow:0 6px 14px rgba(245,158,11,.3); }
  .btn:disabled{ opacity:.5; cursor:not-allowed; }
  .players{ display:flex; flex-direction:column; gap:8px; padding-right:2px; overflow:visible; }
  .player-item{ display:flex; align-items:center; gap:8px; padding:8px; background:#0f1320; border:1px solid #1d2437; border-radius:12px; }
  .pill{ width:16px; height:16px; border-radius:50%; border:1px solid #0008; box-shadow:0 0 0 2px #0003 inset; }
  .player-name{ font-weight:700; }
  .player-total{ margin-left:auto; color:#a1b1f7; font-weight:600; }

  .hud{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:8px; }
  .stat{
    background:#0e1321; border:1px solid #1b2236; border-radius:12px; padding:8px 10px;
    display:flex; align-items:center; gap:8px; min-height:42px;
  }
  .dot{ width:12px; height:12px; border-radius:50%; border:1px solid #0008; }
  .kpi{ font-weight:800; letter-spacing:.3px; }
  .record{ color:#ffe78c; font-weight:700; }
  .countdown{ font-variant-numeric:tabular-nums; font-weight:800; }
  .hint{ font-size:.85rem; color:#9fb3ff; }

  /* gráfico de barras */
  .chart{
    display:flex; align-items:flex-end; gap:10px;
    height:var(--bar-height);
    border-radius:12px; padding:10px;
    background:#0e1321; border:1px solid #1b2236;
  }
  .bar{
    flex:1; height:100%;
    display:flex; flex-direction:column;
    align-items:center; justify-content:flex-end;
    gap:4px; transition:all .2s;
  }
  .bar-rect{
    position:relative; width:80%; height:100%;
    border-radius:8px; background:#1b2236;
    border:1px solid #2c385a; overflow:hidden;
    display:flex; align-items:flex-end; justify-content:center;
  }
  .bar-fill{
    position:absolute; left:0; bottom:0;
    width:100%; height:0%;
    background:linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.2)), var(--col,#6aa0ff);
    mix-blend-mode:screen;
    transition:height .3s ease;
  }
  .bar-val{ font-size:.9rem; font-weight:700; color:#e7ecff; margin-top:4px; }
  .bar-name{ font-size:.8rem; color:#dbe2ff; text-align:center; overflow:hidden; white-space:nowrap; width:100%; }

  /* círculo */
  .circle{
    width:var(--circle-size); height:var(--circle-size);
    background:radial-gradient(circle at 35% 35%, #2a3450, #11182b 60%);
    border:2px solid #2b3a62; border-radius:50%;
    box-shadow:0 12px 40px rgba(0,0,0,.5), inset 0 6px 22px rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; position:relative; transition:transform .08s ease;
  }
  .circle:active{ transform:scale(.98); }
  .circle.inactive{ opacity:.45; filter:grayscale(.2); cursor:not-allowed; }
/* 🟢 Estado activo: verde brillante cuando se puede pulsar */
.circle.active {
  background: radial-gradient(circle at 35% 35%, #1a3f1a, #0a200a 60%);
  border: 2px solid #22c55e;
  opacity: 1;
  filter: none;
}

/* === Botón por imágenes === */
.tap-button{
  width: var(--circle-size);
  height: var(--circle-size);
  cursor: pointer;
  user-select: none;
  border-radius: 50%;
  transition: transform .1s ease, opacity .2s ease;
}
.tap-button.inactive{
  opacity: .5;
  cursor: not-allowed;
}
.tap-button:active{
  transform: scale(.95);
}

  .tap-num{ position:absolute; bottom:-26px; color:#9fb3ff; font-weight:800; letter-spacing:.4px; }

  ::-webkit-scrollbar{ height:8px; width:8px; }
  ::-webkit-scrollbar-thumb{ background:#2a3350; border-radius:10px; }
</style>
</head>
<body>
<div class="app">

  <!-- CONFIGURACIÓN -->
  <div class="top">
    <div class="card">
      <h3 class="section-title">Configuración</h3>
      <div class="controls">
        <div class="field"><label>⏱️ Tiempo (s)</label><input id="seconds" type="number" min="3" max="120" value="10" /></div>
        <div class="field"><label>🔁 Rondas</label><input id="rounds" type="number" min="1" max="10" value="3" /></div>
        <div class="field"><label>🎚️ Dificultad</label><input id="difficulty" type="range" min="1" max="100" value="50" /><div class="muted small">Más <b>difícil</b> → círculo <b>más pequeño</b></div></div>
        <div class="field"><label class="switch"><input id="sound-on" type="checkbox" checked /><span>🔊 Sonido</span></label></div>
      </div>
      <hr style="border:none;border-top:1px solid #253050; margin:12px 0" />
      <div class="row"><input id="player-name" type="text" placeholder="Nombre (máx.8 Caracteres)" maxlength="8" /><input id="player-color" type="color" value="#ff4757" /><button id="add-player" class="btn">+ Añadir</button></div>
      <div class="muted small" style="margin-top:6px">Máximo 20 jugadores. Nombre y color únicos.</div>
      <div class="players" id="players-list"></div>
      <div class="row" style="margin-top:10px"><button id="start-game" class="btn">▶️ Comenzar juego</button><button id="reset-game" class="btn secondary">🔄 Nueva partida</button><button id="clear-record" class="btn warning">🏆 Borrar récord</button></div>
    </div>
  </div>

  <!-- EN JUEGO -->
  <div class="middle">
    <div class="card">
      <h3 class="section-title">En juego</h3>
      <div class="hud">
        <div class="stat"><div id="hud-player-dot" class="dot"></div><div><span class="muted small">Jugador:</span> <span id="hud-player" class="kpi">—</span></div></div>
        <div class="stat"><span class="muted small">Pulsaciones turno:</span><span id="hud-taps" class="kpi">0</span></div>
        <div class="stat"><span class="muted small">⏳ Cuenta atrás:</span><span id="hud-countdown" class="countdown">—</span></div>
        <div class="stat"><span class="muted small">🏆 Récord:</span><span id="hud-record" class="record">—</span></div>
      </div>
      <div style="margin-top:10px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
        <div class="muted small">Gráfico de totales acumulados (100% = 10 × segundos × rondas)</div>
        <div class="hint small" id="scale-hint">Escala: —</div>
      </div>
      <div class="chart" id="chart"></div>
      <div id="winner-display" class="muted" style="margin-top:10px; text-align:center; font-weight:700; color:#ffe78c;"></div>
    </div>
  </div>

  <!-- CÍRCULO -->
<div class="bottom">
  <img id="tap-circle" src="boton_inactivo.png" alt="Botón de pulsación" class="tap-button inactive">
  <div id="tap-readout" class="tap-num">0</div>
</div>
</div>

<script>
(() => {
"use strict";

/* ===== Estado ===== */
const state={
  players:[], roundsCount:3, secondsPerTurn:10, difficulty:50, soundOn:true,
  currentRound:1, currentIndex:-1, inGame:false,
  preCountdown:3, preTimerId:null, turnTimerId:null,
  timeLeft:0, tapsThisTurn:0, bestInSession:0, active:false
};

/* ===== Selectores ===== */
const elName=document.getElementById("player-name");
const elColor=document.getElementById("player-color");
const btnAdd=document.getElementById("add-player");
const list=document.getElementById("players-list");

const elSeconds=document.getElementById("seconds");
const elRounds=document.getElementById("rounds");
const elDiff=document.getElementById("difficulty");
const elSound=document.getElementById("sound-on");

const btnStart=document.getElementById("start-game");
const btnReset=document.getElementById("reset-game");
const btnClearRecord=document.getElementById("clear-record");

const hudPlayer=document.getElementById("hud-player");
const hudDot=document.getElementById("hud-player-dot");
const hudTaps=document.getElementById("hud-taps");
const hudCd=document.getElementById("hud-countdown");
const hudRecord=document.getElementById("hud-record");
const scaleHint=document.getElementById("scale-hint");
const winnerDisplay=document.getElementById("winner-display");

const chart=document.getElementById("chart");
const circle=document.getElementById("tap-circle");
const readout=document.getElementById("tap-readout");

/* ===== Cambios de imagen del botón ===== */
function setCircleActive(active){
  if(active){
    circle.src = "boton_activo.png";  // se puede pulsar
    circle.classList.remove("inactive");
    circle.style.opacity = "1";
  }else{
    circle.src = "boton_inactivo.png"; // desactivado
    circle.classList.add("inactive");
    circle.style.opacity = "0.5";
  }
}

/* ===== Audio ===== */
let audioCtx=null;
function ensureAudio(){ if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==="suspended") audioCtx.resume(); }
function beep(){
  if(!state.soundOn) return;
  try{
    ensureAudio();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type="square"; o.frequency.value=880; g.gain.value=0.001;
    o.connect(g); g.connect(audioCtx.destination);
    const now=audioCtx.currentTime;
    o.start(now);
    g.gain.linearRampToValueAtTime(0.12, now+0.015);
    g.gain.exponentialRampToValueAtTime(0.00001, now+0.10);
    o.stop(now+0.12);
  }catch(e){}
}

/* ===== Sonidos personalizados de cuenta atrás ===== */
function beepCountdown(freq=440, duration=200, volume=0.1){
  if(!state.soundOn) return;
  try{
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.value = freq;
    g.gain.value = volume;
    o.connect(g); g.connect(audioCtx.destination);
    const now = audioCtx.currentTime;
    o.start(now);
    g.gain.exponentialRampToValueAtTime(0.0001, now + duration/1000);
    o.stop(now + duration/1000);
  }catch(e){}
}

/* ===== Récord (localStorage) ===== */
const REC_KEY="tapbattle_record_v1";
function loadRecord(){ try{ const r=JSON.parse(localStorage.getItem(REC_KEY)||"{}"); return (r&&Number.isFinite(r.taps))?r:{name:"—",taps:0}; }catch(e){ return {name:"—",taps:0}; } }
function saveRecord(r){ try{ localStorage.setItem(REC_KEY, JSON.stringify(r)); }catch(e){} }
let record=loadRecord();
function updateRecordHUD(){ hudRecord.textContent=(record.taps>0)?`${record.taps} — ${record.name}`:"—"; updateScaleHint(); }

/* ===== Utils ===== */
function uid(){ return Math.random().toString(36).slice(2,9); }
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
function difficultyToCircleSize(v){ const vmin=18+(100-v)*(60-18)/100; return `${vmin}vmin`; }
function applyCircleSize(){ document.documentElement.style.setProperty("--circle-size", difficultyToCircleSize(state.difficulty)); }

/* ===== Jugadores ===== */
function renderPlayers(){
  list.innerHTML="";
  if(state.players.length===0){
    const e=document.createElement("div");
    e.className="muted small";
    e.textContent="Sin jugadores. Añade al menos 1.";
    list.appendChild(e);
  }else{
    state.players.forEach(p=>{
      const row=document.createElement("div"); row.className="player-item";
      const dot=document.createElement("div"); dot.className="pill"; dot.style.background=p.color;
      const name=document.createElement("div"); name.className="player-name"; name.textContent=p.name;
      const total=document.createElement("div"); total.className="player-total"; total.textContent=p.total;
      const rm=document.createElement("button"); rm.className="btn secondary"; rm.textContent="Eliminar"; rm.onclick=()=>removePlayer(p.id);
      row.append(dot,name,total,rm);
      list.appendChild(row);
    });
  }
  renderChart();
}

function addPlayer(){
  const name=(elName.value||"").trim(), color=(elColor.value||"").trim();
  if(!name){ warn("Introduce un nombre."); return; }
  if(state.players.length>=20){ warn("Máximo 20 jugadores."); return; }
  if(state.players.some(p=>p.name.toLowerCase()===name.toLowerCase())){ warn("Nombre ya usado."); return; }
  if(state.players.some(p=>p.color.toLowerCase()===color.toLowerCase())){ warn("Color ya usado."); return; }
  state.players.push({id:uid(), name, color, scores:[], total:0});
  elName.value="";
  renderPlayers();
}

function removePlayer(id){
  if(state.inGame){ warn("No puedes eliminar jugadores durante la partida."); return; }
  state.players=state.players.filter(p=>p.id!==id);
  renderPlayers();
}

/* ===== Escala del gráfico (tu nueva regla) ===== */
function getScaleBase(){
  const base = 10 * state.secondsPerTurn * state.roundsCount; // 100% = 10 × s × rondas
  return Math.max(base, 1);
}
function updateScaleHint(){
  scaleHint.textContent = `Escala 100% = ${getScaleBase()} toques`;
}

/* ===== Gráfico ===== */
function renderChart(previewId=null, previewTotal=null){
  chart.innerHTML="";
  const base=getScaleBase();
  if(state.players.length===0){
    const m=document.createElement("div"); m.className="muted"; m.textContent="Añade jugadores para ver el gráfico.";
    chart.appendChild(m); return;
  }
  state.players.forEach(p=>{
    const shown=(previewId===p.id && Number.isFinite(previewTotal)) ? previewTotal : p.total;
    const pct=Math.max(2, Math.min(100, Math.round((shown/base)*100))); // min 2% visible
    const bar=document.createElement("div"); bar.className="bar";
    const rect=document.createElement("div"); rect.className="bar-rect";
    const fill=document.createElement("div"); fill.className="bar-fill";
    fill.style.setProperty("--col", p.color);
    fill.style.height=pct+"%";
    rect.appendChild(fill);
    const val=document.createElement("div"); val.className="bar-val"; val.textContent=shown;
    const name=document.createElement("div"); name.className="bar-name"; name.textContent=p.name;
    bar.append(rect,val,name);
    chart.appendChild(bar);
  });
}

/* ===== HUD ===== */
function setHUDPlayer(p){ hudPlayer.textContent=p?p.name:"—"; hudDot.style.background=p?p.color:"#777"; }
function setHUDTaps(n){ hudTaps.textContent=String(n); }
function setHUDCountdown(t){ hudCd.textContent=t; }

/* ===== Partida ===== */
function canStart(){
  if(state.players.length<1){ warn("Añade al menos 1 jugador."); return false; }
  if(state.roundsCount<1){ warn("Rondas debe ser ≥ 1."); return false; }
  if(state.secondsPerTurn<3){ warn("Tiempo por turno mínimo: 3s."); return false; }
  return true;
}

function startGame(){
  if(!canStart()) return;
  ensureAudio(); // ⚡ activar el contexto de audio tras la interacción del usuario
  state.inGame=true;
  state.currentRound=1;
  state.currentIndex=-1;
  state.bestInSession=0;
  winnerDisplay.textContent="";                // limpiar mensaje de ganador
  elSeconds.disabled=elRounds.disabled=elDiff.disabled=true;
  btnStart.disabled=true;
  proceedNextTurn();
}

function proceedNextTurn(){
  state.currentIndex++;
  if(state.currentIndex>=state.players.length){
    state.currentIndex=0;
    state.currentRound++;
    if(state.currentRound>state.roundsCount){ return endGame(); }
  }
  const p=state.players[state.currentIndex];
  setHUDPlayer(p);
  state.tapsThisTurn=0; setHUDTaps(0); readout.textContent="0";
  circle.classList.add("inactive");
  state.active=false;
  startPreCountdown();
}

function startPreCountdown(){
  clearTimers();
  let remain = 10; // ⏱️ ahora la cuenta atrás dura 10 segundos
  setHUDCountdown(`Inicio en ${remain}s`);

  state.preTimerId = setInterval(()=>{
    remain--; // 🔹 resta 1 segundo cada vez

    // === Pitidos previos personalizados ===
    if(remain === 3){
      // 🔊 Un pitido corto cuando faltan 3 segundos
      beepCountdown(700, 150, 0.2);
    }
    else if(remain === 2){
      // 🔊 Dos pitidos cortos seguidos cuando faltan 2 segundos
      beepCountdown(750, 120, 0.2);
      setTimeout(()=>beepCountdown(750, 120, 0.2), 200);
    }
    else if(remain === 1){
      // 🔊 Un pitido largo de 1 segundo cuando falta 1 segundo
      beepCountdown(900, 1000, 0.3);
    }

    // === Fin de la cuenta atrás ===
    if(remain <= 0){
      clearInterval(state.preTimerId);
      state.preTimerId = null;
      startTurn(); // inicia el turno
    }else{
      setHUDCountdown(`Inicio en ${remain}s`);
    }
  }, 1000);
}
function startTurn(){
  clearTimers();
  state.active = true;
  setCircleActive(true); // 🔊 activa el botón e imagen "boton_activo.png"
  circle.classList.remove("inactive");

  state.timeLeft = state.secondsPerTurn;
  setHUDCountdown(`${state.timeLeft}s`);

  state.turnTimerId = setInterval(()=>{
    state.timeLeft--;
    if(state.timeLeft <= 0){
      setHUDCountdown("0s");
      endTurn();
    }else{
      setHUDCountdown(`${state.timeLeft}s`);
    }
  }, 1000);
}

function endTurn(){
  clearTimers();
  state.active=false;
  circle.classList.add("inactive");

  const p=state.players[state.currentIndex];
  p.scores.push(state.tapsThisTurn);
  p.total=p.scores.reduce((a,b)=>a+b,0);

  if(state.tapsThisTurn>state.bestInSession) state.bestInSession=state.tapsThisTurn;

  // (el récord histórico ya no afecta a la escala; se mantiene informativo)
  if(state.tapsThisTurn>record.taps){
    record={name:p.name, taps:state.tapsThisTurn};
    saveRecord(record);
    updateRecordHUD();
  }

  renderPlayers(); // actualiza lista + gráfico
  setTimeout(proceedNextTurn, 600);
}

function endGame(){
  state.inGame=false;
  clearTimers();
  state.active=false;
  setCircleActive(false);
  setHUDCountdown("Fin de partida");
  elSeconds.disabled=elRounds.disabled=elDiff.disabled=false;
  btnStart.disabled=false;

  const sorted=[...state.players].sort((a,b)=>b.total-a.total);
  const winner=sorted[0];

  // Mostrar ganador en el panel En juego
  if(winnerDisplay){
    winnerDisplay.textContent = `🏁 Fin de partida — Ganador: ${winner ? `${winner.name} (${winner.total} toques)` : "—"} · Récord: ${record.taps} — ${record.name}`;
  }
}

function clearTimers(){
  if(state.preTimerId){ clearInterval(state.preTimerId); state.preTimerId=null; }
  if(state.turnTimerId){ clearInterval(state.turnTimerId); state.turnTimerId=null; }
}

function resetGame(){
  clearTimers();
  state.inGame=false;
  state.currentRound=1;
  state.currentIndex=-1;
  state.bestInSession=0;
  state.tapsThisTurn=0;
  setHUDPlayer(null);
  setHUDTaps(0);
  setHUDCountdown("—");
  circle.classList.add("inactive");
  state.active=false;

  elSeconds.disabled=elRounds.disabled=elDiff.disabled=false;
  btnStart.disabled=false;

  winnerDisplay.textContent = ""; // limpiar ganador
  state.players.forEach(p=>{ p.scores=[]; p.total=0; });
  renderPlayers();
}

/* ===== Eventos UI ===== */
btnAdd.addEventListener("click", addPlayer);
elName.addEventListener("keydown", (e)=>{ if(e.key==="Enter") addPlayer(); });

elSeconds.addEventListener("change", ()=>{
  state.secondsPerTurn = clamp(parseInt(elSeconds.value||"10",10), 3, 120);
  elSeconds.value = state.secondsPerTurn;
  updateScaleHint(); renderChart(); // actualizar escala inmediatamente
});
elRounds.addEventListener("change", ()=>{
  state.roundsCount = clamp(parseInt(elRounds.value||"3",10), 1, 10);
  elRounds.value = state.roundsCount;
  updateScaleHint(); renderChart(); // actualizar escala inmediatamente
});
elDiff.addEventListener("input", ()=>{
  state.difficulty = clamp(parseInt(elDiff.value||"50",10), 1, 100);
  applyCircleSize();
});
elSound.addEventListener("change", ()=>{ state.soundOn = !!elSound.checked; });

btnStart.addEventListener("click", startGame);
btnReset.addEventListener("click", resetGame);
btnClearRecord.addEventListener("click", ()=>{
  if(confirm("¿Seguro que quieres borrar el récord histórico?")){
    record = { name:"—", taps:0 };
    saveRecord(record);
    updateRecordHUD();
    renderChart();
  }
});

/* ===== Taps ===== */
function handleTap(ev){
  if(!state.active) return;
  const rect=circle.getBoundingClientRect();
  const x=ev.clientX ?? (ev.touches && ev.touches[0]?.clientX);
  const y=ev.clientY ?? (ev.touches && ev.touches[0]?.clientY);
  if(x==null || y==null) return;
  if(x<rect.left || x>rect.right || y<rect.top || y>rect.bottom) return;

  state.tapsThisTurn++;
  readout.textContent = String(state.tapsThisTurn);
  setHUDTaps(state.tapsThisTurn);
  beep();

  // previsualiza el total si acabara ahora
  const p=state.players[state.currentIndex];
  const previewTotal = p.scores.reduce((a,b)=>a+b,0) + state.tapsThisTurn;
  renderChart(p.id, previewTotal);

  ev.preventDefault();
}
circle.addEventListener("pointerdown", handleTap, { passive:false });
circle.addEventListener("touchstart", handleTap, { passive:false });
// Cambiar imagen mientras se pulsa
circle.addEventListener("pointerdown", ()=>{
  if(state.active) circle.src = "boton_pulsado.png";
});
circle.addEventListener("pointerup", ()=>{
  if(state.active) circle.src = "boton_activo.png";
});
circle.addEventListener("touchstart", ()=>{
  if(state.active) circle.src = "boton_pulsado.png";
});
circle.addEventListener("touchend", ()=>{
  if(state.active) circle.src = "boton_activo.png";
});

/* ===== Toasts (por si los necesitas) ===== */
let lastToast=null;
function toast(msg){
  if(lastToast){ lastToast.remove(); lastToast=null; }
  const t=document.createElement("div");
  t.textContent=msg;
  t.style.position="fixed";
  t.style.left="50%"; t.style.top="18px"; t.style.transform="translateX(-50%)";
  t.style.background="#0e1321";
  t.style.border="1px solid #203055";
  t.style.padding="10px 14px";
  t.style.borderRadius="12px";
  t.style.boxShadow="0 10px 24px rgba(0,0,0,.35)";
  t.style.zIndex="9999";
  t.style.fontWeight="700";
  document.body.appendChild(t);
  lastToast=t;
  setTimeout(()=>{ t.style.opacity="0"; t.style.transition="opacity .4s"; }, 1600);
  setTimeout(()=>{ t.remove(); if(lastToast===t) lastToast=null; }, 2100);
}
function warn(m){ toast("⚠️ "+m); }
function info(m){ toast("ℹ️ "+m); }

/* ===== Init ===== */
elSeconds.value=state.secondsPerTurn;
elRounds.value=state.roundsCount;
elDiff.value=state.difficulty;
elSound.checked=state.soundOn;
applyCircleSize();
updateRecordHUD();
updateScaleHint();
renderPlayers();
setHUDPlayer(null);
setHUDTaps(0);
setHUDCountdown("—");

})();
</script>
</body>
</html>
